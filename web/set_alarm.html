<!DOCTYPE html>
<meta charset="utf-8" />

<html>
<body>

    <input type="time" id="alarm_time" name="alarm time" value="00:00:00">
    <input type="date" id="alarm_date" name="alarm date" value="2018-07-22">

    <input type="button" id="set_alarm" value="set alarm">

    <script>
  
        function today() {
            return new Date();
        }

        function tomorrow() {
            return new Date(today().getTime() + 24 * 60 * 60 * 1000);
        }

        // Get formatted date YYYY-MM-DD
        function getFormattedDate(date) {
            return date.getFullYear()
                + "-"
                + ("0" + (date.getMonth() + 1)).slice(-2)
                + "-"
                + ("0" + date.getDate()).slice(-2);
        }      

        function getDefaultAlarmDate() {
            var now = new Date();
            if (now.getHours < 6) {
                return today();
            } else {
                return tomorrow();
            }
        }


        function display_alarm_success() {         
            document.write("alarm set succesfully");
        }
        function display_alarm_fail() {
            document.write("alarm set failed!!!!");
        }

        function setAlarm() {

            var alarm_date = document.getElementById("alarm_date").valueAsDate;
            var alarm_time = document.getElementById("alarm_time").valueAsDate;

            alarm_date.setHours(alarm_time.getHours());
            alarm_date.setMinutes(alarm_time.getMinutes());
            alarm_date.setSeconds(alarm_time.getSeconds());
            var unix_time = alarm_date.getTime()/1000;
            console.log(unix_time);
            
            //var formData = new FormData();
            //formData.append("timestamp", ""+unix_time);

            var request = new XMLHttpRequest();
            request.onload = function () {

                // Because of javascript's fabulous closure concept, the XMLHttpRequest "request"
                // object declared above is available in this function even though this function
                // executes long after the request is sent and long after this function is
                // instantiated. This fact is CRUCIAL to the workings of XHR in ordinary
                // applications.

                // You can get all kinds of information about the HTTP response.
                var status = request.status; // HTTP response status, e.g., 200 for "200 OK"
                var data = request.responseText; // Returned data, e.g., an HTML document.
                if (status == 200) {
                    console.log(status)
                    display_alarm_success();
                } else {
                    console.log(status);
                }
            }

            request.addEventListener("error", display_alarm_fail);
            request.addEventListener("abort", display_alarm_fail);
            var shouldBeAsync = true;
            request.open("POST", "/set_alarm", shouldBeAsync);
            request.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            request.send("timestamp","12");

        }

        document.getElementById("alarm_date").valueAsDate = getDefaultAlarmDate();
        document.getElementById("set_alarm").onclick = setAlarm;

    </script>

</body>
</html>